var cov_1tx6m3jyj=function(){var path="/home/adonis/Documentos/ccem-dev/dcm-service/api/app/services/DCMApiService.js";var hash="99347c3221202b3a5105e6abe046c2e45a5e06fb";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/adonis/Documentos/ccem-dev/dcm-service/api/app/services/DCMApiService.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:34}},"1":{start:{line:2,column:14},end:{line:2,column:30}},"2":{start:{line:3,column:30},end:{line:3,column:64}},"3":{start:{line:4,column:18},end:{line:4,column:50}},"4":{start:{line:6,column:0},end:{line:6,column:48}},"5":{start:{line:9,column:15},end:{line:9,column:38}},"6":{start:{line:11,column:15},end:{line:11,column:30}},"7":{start:{line:14,column:16},end:{line:14,column:26}},"8":{start:{line:24,column:0},end:{line:29,column:2}},"9":{start:{line:33,column:4},end:{line:53,column:7}},"10":{start:{line:34,column:27},end:{line:46,column:9}},"11":{start:{line:47,column:8},end:{line:52,column:10}},"12":{start:{line:48,column:16},end:{line:48,column:50}},"13":{start:{line:48,column:27},end:{line:48,column:50}},"14":{start:{line:49,column:29},end:{line:49,column:45}},"15":{start:{line:50,column:16},end:{line:50,column:32}},"16":{start:{line:57,column:4},end:{line:73,column:7}},"17":{start:{line:58,column:28},end:{line:67,column:9}},"18":{start:{line:68,column:8},end:{line:72,column:11}},"19":{start:{line:69,column:12},end:{line:69,column:46}},"20":{start:{line:69,column:23},end:{line:69,column:46}},"21":{start:{line:70,column:25},end:{line:70,column:41}},"22":{start:{line:71,column:12},end:{line:71,column:28}},"23":{start:{line:77,column:4},end:{line:93,column:7}},"24":{start:{line:78,column:30},end:{line:87,column:9}},"25":{start:{line:88,column:8},end:{line:92,column:11}},"26":{start:{line:89,column:12},end:{line:89,column:46}},"27":{start:{line:89,column:23},end:{line:89,column:46}},"28":{start:{line:90,column:29},end:{line:90,column:45}},"29":{start:{line:91,column:12},end:{line:91,column:32}},"30":{start:{line:97,column:4},end:{line:133,column:7}},"31":{start:{line:98,column:24},end:{line:118,column:9}},"32":{start:{line:119,column:18},end:{line:128,column:10}},"33":{start:{line:120,column:25},end:{line:120,column:27}},"34":{start:{line:121,column:12},end:{line:123,column:15}},"35":{start:{line:122,column:16},end:{line:122,column:35}},"36":{start:{line:124,column:12},end:{line:127,column:15}},"37":{start:{line:125,column:27},end:{line:125,column:48}},"38":{start:{line:126,column:16},end:{line:126,column:30}},"39":{start:{line:129,column:8},end:{line:131,column:11}},"40":{start:{line:130,column:12},end:{line:130,column:26}},"41":{start:{line:132,column:8},end:{line:132,column:18}}},fnMap:{"0":{name:"getStudyInformation",decl:{start:{line:32,column:9},end:{line:32,column:28}},loc:{start:{line:32,column:62},end:{line:54,column:1}},line:32},"1":{name:"(anonymous_1)",decl:{start:{line:33,column:23},end:{line:33,column:24}},loc:{start:{line:33,column:44},end:{line:53,column:5}},line:33},"2":{name:"(anonymous_2)",decl:{start:{line:47,column:30},end:{line:47,column:31}},loc:{start:{line:47,column:63},end:{line:51,column:13}},line:47},"3":{name:"getSeriesInformation",decl:{start:{line:56,column:9},end:{line:56,column:29}},loc:{start:{line:56,column:47},end:{line:74,column:1}},line:56},"4":{name:"(anonymous_4)",decl:{start:{line:57,column:23},end:{line:57,column:24}},loc:{start:{line:57,column:44},end:{line:73,column:5}},line:57},"5":{name:"(anonymous_5)",decl:{start:{line:68,column:31},end:{line:68,column:32}},loc:{start:{line:68,column:64},end:{line:72,column:9}},line:68},"6":{name:"getInstanceInformation",decl:{start:{line:76,column:9},end:{line:76,column:31}},loc:{start:{line:76,column:50},end:{line:94,column:1}},line:76},"7":{name:"(anonymous_7)",decl:{start:{line:77,column:23},end:{line:77,column:24}},loc:{start:{line:77,column:44},end:{line:93,column:5}},line:77},"8":{name:"(anonymous_8)",decl:{start:{line:88,column:33},end:{line:88,column:34}},loc:{start:{line:88,column:66},end:{line:92,column:9}},line:88},"9":{name:"requestImage",decl:{start:{line:96,column:9},end:{line:96,column:21}},loc:{start:{line:96,column:74},end:{line:134,column:1}},line:96},"10":{name:"(anonymous_10)",decl:{start:{line:97,column:23},end:{line:97,column:24}},loc:{start:{line:97,column:44},end:{line:133,column:5}},line:97},"11":{name:"(anonymous_11)",decl:{start:{line:119,column:41},end:{line:119,column:42}},loc:{start:{line:119,column:60},end:{line:128,column:9}},line:119},"12":{name:"(anonymous_12)",decl:{start:{line:121,column:39},end:{line:121,column:40}},loc:{start:{line:121,column:56},end:{line:123,column:13}},line:121},"13":{name:"(anonymous_13)",decl:{start:{line:124,column:38},end:{line:124,column:39}},loc:{start:{line:124,column:50},end:{line:127,column:13}},line:124},"14":{name:"(anonymous_14)",decl:{start:{line:129,column:24},end:{line:129,column:25}},loc:{start:{line:129,column:33},end:{line:131,column:9}},line:129}},branchMap:{"0":{loc:{start:{line:48,column:16},end:{line:48,column:50}},type:"if",locations:[{start:{line:48,column:16},end:{line:48,column:50}},{start:{line:48,column:16},end:{line:48,column:50}}],line:48},"1":{loc:{start:{line:69,column:12},end:{line:69,column:46}},type:"if",locations:[{start:{line:69,column:12},end:{line:69,column:46}},{start:{line:69,column:12},end:{line:69,column:46}}],line:69},"2":{loc:{start:{line:89,column:12},end:{line:89,column:46}},type:"if",locations:[{start:{line:89,column:12},end:{line:89,column:46}},{start:{line:89,column:12},end:{line:89,column:46}}],line:89}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"99347c3221202b3a5105e6abe046c2e45a5e06fb"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();const request=(cov_1tx6m3jyj.s[0]++,require('request'));const https=(cov_1tx6m3jyj.s[1]++,require('https'));const AuthenticationService=(cov_1tx6m3jyj.s[2]++,require('./AuthenticationService'));const Constants=(cov_1tx6m3jyj.s[3]++,require('../utils/DCMConstants'));cov_1tx6m3jyj.s[4]++;process.env["NODE_TLS_REJECT_UNAUTHORIZED"]=0;// var ARC_PORT = '8443';
var ARC_PORT=(cov_1tx6m3jyj.s[5]++,process.env['ARC_PORT']);var DCM_HOST=(cov_1tx6m3jyj.s[6]++,'143.54.220.73');// var DCM_HOST = process.env['DCM_HOST'];
let AETS_NAME=(cov_1tx6m3jyj.s[7]++,'DCM4CHEE');// var searchOptions = {'patientID': '0002', 'modality': 'XC'};
// var searchOptions = {'patientID': '1941139', 'modality': 'US'};
// VariÃ¡veis no Postman para testes (Body): (Pode deletar)
//http://localhost:8081/api/retinography
// {"recruitmentNumber":"0002","examName":"Retinography","sending":0}
/*===============*/cov_1tx6m3jyj.s[8]++;module.exports={getStudyInformation:getStudyInformation,getSeriesInformation:getSeriesInformation,getInstanceInformation:getInstanceInformation,requestImage:requestImage};/*==============*/function getStudyInformation(token,searchOptions,qsOptions){cov_1tx6m3jyj.f[0]++;cov_1tx6m3jyj.s[9]++;return new Promise((resolve,reject)=>{cov_1tx6m3jyj.f[1]++;var studyOptions=(cov_1tx6m3jyj.s[10]++,{method:'GET',url:'https://'+DCM_HOST+':'+ARC_PORT+'/dcm4chee-arc/aets/'+AETS_NAME+'/rs/studies',qs:{'PatientID':searchOptions.patientID,'ModalitiesInStudy':searchOptions.modality,'orderby':'StudyDate,StudyTime','includedefaults':'false','includefield':'StudyDate,RetrieveURL,StudyInstanceUID,NumberOfStudyRelatedSeries',...qsOptions},headers:{'cache-control':'no-cache',Authorization:'Bearer '+token}});cov_1tx6m3jyj.s[11]++;request(studyOptions,function(error,response,body){cov_1tx6m3jyj.f[2]++;cov_1tx6m3jyj.s[12]++;if(error){cov_1tx6m3jyj.b[0][0]++;cov_1tx6m3jyj.s[13]++;throw new Error(error);}else{cov_1tx6m3jyj.b[0][1]++;}let parsed=(cov_1tx6m3jyj.s[14]++,JSON.parse(body));cov_1tx6m3jyj.s[15]++;resolve(parsed);});});}function getSeriesInformation(token,studyURL){cov_1tx6m3jyj.f[3]++;cov_1tx6m3jyj.s[16]++;return new Promise((resolve,reject)=>{cov_1tx6m3jyj.f[4]++;var seriesOptions=(cov_1tx6m3jyj.s[17]++,{url:studyURL+'/series',method:'GET',qs:{'orderby':'SeriesNumber','includedefaults':'false','includefield':'Modality,RetrieveURL,SeriesInstanceUID,SeriesNumber,NumberOfSeriesRelatedInstances,Laterality'},headers:{'cache-control':'no-cache',Authorization:'Bearer '+token}});cov_1tx6m3jyj.s[18]++;request(seriesOptions,function(error,response,body){cov_1tx6m3jyj.f[5]++;cov_1tx6m3jyj.s[19]++;if(error){cov_1tx6m3jyj.b[1][0]++;cov_1tx6m3jyj.s[20]++;throw new Error(error);}else{cov_1tx6m3jyj.b[1][1]++;}let parsed=(cov_1tx6m3jyj.s[21]++,JSON.parse(body));cov_1tx6m3jyj.s[22]++;resolve(parsed);});});}function getInstanceInformation(token,seriesURL){cov_1tx6m3jyj.f[6]++;cov_1tx6m3jyj.s[23]++;return new Promise((resolve,reject)=>{cov_1tx6m3jyj.f[7]++;var instanceOptions=(cov_1tx6m3jyj.s[24]++,{method:'GET',url:seriesURL+'/instances',qs:{'orderby':'InstanceNumber','includedefaults':'false','includefield':Constants.InstanceUID},headers:{'cache-control':'no-cache',Authorization:'Bearer '+token}});cov_1tx6m3jyj.s[25]++;request(instanceOptions,function(error,response,body){cov_1tx6m3jyj.f[8]++;cov_1tx6m3jyj.s[26]++;if(error){cov_1tx6m3jyj.b[2][0]++;cov_1tx6m3jyj.s[27]++;throw new Error(error);}else{cov_1tx6m3jyj.b[2][1]++;}let parsedBody=(cov_1tx6m3jyj.s[28]++,JSON.parse(body));cov_1tx6m3jyj.s[29]++;resolve(parsedBody);});});}function requestImage(token,studyUID,seriesUID,instanceUID,qtOptions){cov_1tx6m3jyj.f[9]++;cov_1tx6m3jyj.s[30]++;return new Promise((resolve,reject)=>{cov_1tx6m3jyj.f[10]++;const options=(cov_1tx6m3jyj.s[31]++,{method:'GET',hostname:DCM_HOST,port:ARC_PORT,path:"/dcm4chee-arc/aets/"+AETS_NAME+"/wado?",qs:{requestType:'WADO',studyUID:studyUID,seriesUID:seriesUID,objectUID:instanceUID,contentType:'image/jpeg',columns:'280',//todo remove
frameNumber:'1',...qtOptions},headers:{'Authorization':'Bearer '+token,"cache-control":"no-cache","Content-Type":"image/jpeg"}});var req=(cov_1tx6m3jyj.s[32]++,https.request(options,incomingMessage=>{cov_1tx6m3jyj.f[11]++;var chunks=(cov_1tx6m3jyj.s[33]++,[]);cov_1tx6m3jyj.s[34]++;incomingMessage.on("data",function(chunk){cov_1tx6m3jyj.f[12]++;cov_1tx6m3jyj.s[35]++;chunks.push(chunk);});cov_1tx6m3jyj.s[36]++;incomingMessage.on("end",function(){cov_1tx6m3jyj.f[13]++;var body=(cov_1tx6m3jyj.s[37]++,Buffer.concat(chunks));cov_1tx6m3jyj.s[38]++;resolve(body);});}));cov_1tx6m3jyj.s[39]++;req.on('error',error=>{cov_1tx6m3jyj.f[14]++;cov_1tx6m3jyj.s[40]++;reject(error);});cov_1tx6m3jyj.s[41]++;req.end();});}